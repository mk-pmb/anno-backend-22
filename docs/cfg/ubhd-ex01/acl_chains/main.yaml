%YAML 1.2
# -*- coding: UTF-8, tab-width: 4 -*-
---

^:  # <-- Chain name. `^` means to use the basename of the filename.

  - if: always
    tendency:
        '*': deny
        # `tendency` sets tentative decisions for selected privileges,
        # which can be overturned by later rules.
        # `*` is the fallback privilege, used when the required privilege
        # has no explicit decision.
        # This entire rule is redundant, because the built-in default is
        # to deny everything.

        lookupAnnoTargets: allow
        # ^- Required pre-condition for "read" privilege.

        discover: allow
        # ^- Required to read version history


  - if:
        memberOfAclGroup: 'suspended'
    decide:
        '*': deny
        # `decide` sets the decisions for selected privileges and stops
        # ACL processing, thus making the decisions final.

  - if:
        memberOfAclGroup: 'superadmin'
    decide:
        '*': allow

  - unless:
        memberOfAclGroup: 'superadmin'
    decide:
        shutdown: deny
        # Lack of a '*' entry means this rule has no effect for actions not
        # mentioned. The ACL processing will continue unfettered for requests
        # that do not require the "shutdown" permission.


  - if:
        memberOfAclGroup: 'doi_sources'
    decide:
        stamp_any_add_dc_identifier: allow

  - if:
        memberOfAclGroup: 'doi_request_watchers'
    decide:
        search_hasStamp__ubhd_doiAssign: allow


  - ifAll:
      - paramInList:
            param: 'serviceId'
            list:
              - 'anno-frontend-tests'
      - isLoggedIn
    decide:
        create: allow
        create_across_services: allow
        read: allow
    # debugDump: meta


  - param: 'serviceId'
    if:
        paramInList:
            - 'diglit'
            - 'journals'
    aclSubChain: 'ðŸ“š_rules'
        # ^-- Apply the rules from `ðŸ“š_rules.yaml` right now, where ðŸ“š
        #   is the placeholder for serviceId.











...
